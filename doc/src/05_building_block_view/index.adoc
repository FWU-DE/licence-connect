ifndef::imagesdir[:imagesdir: ../images]

[[section-building-block-view]]

== Building Block View

=== Level 1: Whitebox Overall System

[plantuml]
----
@startuml Building_Block_Level_1
!include <C4/C4_Component>
!include <office/Servers/application_server>
SHOW_PERSON_OUTLINE()

AddRelTag("dashed", $lineStyle = DashedLine())

System_Ext(vidis, "Vidis", "")
System_Ext(lchalt, "LC Halt", "")
System_Ext(arix, "Arix", "")
System_Ext(bilo_v1, "Bilo_v1", "")
System_Ext(bilo_v2, "Bilo_v2", "")
System_Ext(vidis, "Vidis", "")

System_Boundary(c1, "LC Core"){
    Component(lc_client_mapping, client licence holder mapper)
    Component(lc_licences, licences)
    Component(lc_bilo_v1_client, bilov1)
    Component(lc_bilo_v2_client, bilov2)
    Component(lc_config, config)

    ComponentDb(db, "Database")
}

Rel(vidis, lc_licences, "Lizenzen anfragen (für clientName)")
Rel(vidis, lc_bilo_v1_client, "Lizenzen anfragen (für clientName)")
Rel(vidis, lc_bilo_v2_client, "Lizenzen anfragen (für clientName)")
Rel_R(lc_licences, lc_client_mapping, "Freigeschaltete Lizenzhalter für client abrufen")
Rel(lc_licences, lchalt, "Lizenzen anfragen")
Rel(lc_licences, arix, "Lizenzen anfragen")
Rel_R(lc_client_mapping, db, "Zugriffsfilter konfigurieren")

Rel(lc_bilo_v1_client, bilo_v1, "")
Rel(lc_bilo_v2_client, bilo_v2, "")

@enduml
----

=== Level 2

==== Licences

[plantuml]
----
@startuml

[VIDIS] as vidis #white
[LC Halt] as lchalt #white
[Arix] as arix #white

[client licence holder mapper] as client_mapper

package Licences {
    [Arix Client] as arix_client
    [LC Halt Client] as lchalt_client
    [LicencesController] as lcontroller
    [LicencesCollector] as lcollector
}

vidis --> lcontroller: Fragt nach Lizenzen für \n(Bundesland, Schulnummer, UserId, ClientName)
lcontroller --> lcollector: Fragt nach Lizenzen für \n(Bundesland, Schulnummer, UserId, ClientName)
lcollector --> client_mapper: Fragt nach freigegebenen \n Lizenzhaltern für ClientName
lcollector --> arix_client: Ruft Lizenzen ab für \n(Bundesland, Schulnummer, UserId)
lcollector --> lchalt_client: Ruft Lizenzen ab für \n(Bundesland, Schulnummer, UserId)
arix_client --> arix
lchalt_client --> lchalt

@enduml
----


==== Client Licence Holder Mapper

[plantuml]
----
@startuml

:Admin: as admin

[LicencesCollector] as lcollector
database Database as db

package "client licence holder mapper" {
    [ClientLicenceHolderFilterController] as controller
    [ClientLicenceHolderFilterService] as service
    [ClientLicenceHolderMappingRepository] as repository
}

admin --> controller: Client Mappings verwalten
controller --> service: Client Mappings verwalten
lcollector --> service: Client Mappings abrufen
service --> repository: Client Mappings verwalten
service --> repository: Client Mappings abrufen
repository --> db: Client Mappings persistieren/abrufen

@enduml
----

The client licence holder mapping allows the admin to control which licence holders are requested for which client requests.
Each mapping maps one client name to 0:n licence holders.
Each request to lc core requesting licences is providing a client.
